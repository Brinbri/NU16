<project name="coprocessor" basedir="." default="main">
	<!-- This is the ant build file which compiles code for the coprocessor -->
	

	<property file="build.properties"/>
	<property file="coprocessor.properties"/>
	<property file="${user.home}/wpilib/wpilib.properties"/>
	<property file="${user.home}/wpilib/java/${version}/ant/build.properties"/>
	
	<taskdef resource="net/sf/antcontrib/antlib.xml">
		<classpath>
		  <pathelement location="${wpilib.ant.dir}/ant-contrib.jar"/>
		</classpath>
	</taskdef>
	<taskdef resource="net/jtools/classloadertask/antlib.xml" classpath="${classloadertask.jar}"/>
	<classloader loader="system" classpath="${jsch.jar}"/>

	<target name="clean">
        <delete dir="${build.dir}"/>
    </target>

	<!-- Only code from the specified subdirectories is compiled -->
    <target name="compile">
        <mkdir dir="${classes.dir}"/>
        <javac srcdir="${src.dir}" destdir="${classes.dir}" includeantruntime="false">
        	<include name="${nutrons.dir}/coprocessor/**"/>
        	<include name="${nutrons.dir}/shared/**"/>
		</javac>
    </target>

    <target name="jar" depends="compile">
        <mkdir dir="${jar.dir}"/>
        <jar destfile="${jar.dir}/${ant.project.name}.jar" basedir="${classes.dir}">
            <manifest>
                <attribute name="Main-Class" value="${main-class}"/>
            </manifest>
        </jar>
    </target>

    <target name="run" depends="jar">
        <java jar="${jar.dir}/${ant.project.name}.jar" fork="true"/>
    </target>
	
	<target name="clean-build" depends="clean,jar"/>
	
	<target name="deployg" description="deploys grip.jar to the coprocessor">
		<scp file="${grip.jar}" todir="${username}@${target}:${deploy.dir}/${grip.dir}" password="${password}" trust="true"/>
	</target>
	
	<target name="deploy" depends="jar" description="deploys application and grip profiles to coprocessor">
		<scp file="${gripprofiles.dir}/*" todir="${username}@${target}:${deploy.dir}/${gripprofiles.dir}" password="${password}" trust="true"/>
		<sshexec host="${target}"
		       username="${username}"
		       password="${password}"
		       trust="true"
			   failonerror="false"
		       command="${deploy.kill.command};"/>
		<sshexec host="${target}"
		         username="${username}"
		         password="${password}"
		         trust="true"
		         command="${deploy.run.command}" />
	</target>
	
	<target name="main" depends="clean,deploy"/>
	
	<target name="localrun" depends="clean,run"/>
	
</project>